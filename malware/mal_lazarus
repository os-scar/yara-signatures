rule lazarus_1
{
    meta:
        description = "Detects code which North Korea backed group known as lazarus, used to target its victims"
    strings:
        $pattern1 = /checksvn\(path\.join\(dir,'\/\w+token'\), 'http:\/\/[\w\.]+\/checkupdate\.php'\);/
        $pattern2 = /checksvn\(path\.join\(dir,'\/\w+token'\), 'https:\/\/[\w\.]+\/checkupdate\.php'\);/
        $pattern3 = "process.env['NODE_TLS_REJECT_UNAUTHORIZED'] = 0"
        $pattern4 = "Tk9ERV9UTFNfUkVKRUNUX1VOQVVUSE9SSVpFRA=="
        $pattern5 = "function checksvn(version, projectUrl)"

    condition:
        ($pattern1 or $pattern2) and ($pattern3 or $pattern4) and $pattern5
}

rule lazarus_2
{
    meta:
        description = "Detects code which North Korea backed group known as lazarus, used to target its victims"

    strings:
        $pattern1 = /getsvnroot\('[\w\.]+', '\/getupdate\.php', token, path\.join\(dir ,'check\w+\.js'\)\);/
        $pattern2 = "function getsvnroot(domain, entry, token, path)"
        $pattern3 = "const token = fs.readFileSync(path.join(dir,'jsontoken'))"

    condition:
        all of them
}
